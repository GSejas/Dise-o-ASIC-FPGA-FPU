/* Set of tests for supnorm */

print("=============== Check Supnorm #1 ================");//passes
p = 11692536319630510474283968587625525849426869787677b-163 + x * (23384922893552793741208186896732057180708286140565b-164 + x * (46692941277611593554424973690517694800554713844979b-166 + x * (3891678517537147456387754739468835779118224484425b-164 + x * (1024072943597638219514404758611859127188920401873b-164 + x * 26154763285557255659575812244171511366994513699585b-171))));
midpointmode=on!;
supnorm(p, exp(x), [-1;1], absolute, 2^(-40));

print("=============== Check Supnorm #2 ================");//passes
p = 23384026197294909850223840992809340481141545456185b-164 + x * (46768052394366389249957592514757698261837941537431b-165 + x * (1461501637882931916249380248092291325347144984355b-161 + x * (15589350524874704484650079886308075573528112666971b-166 + x * (31178718928032908530740508502853005869373616353571b-169 + x * (6235660318693530982722236353851527754167773984285b-169 + x * (16632313913972289150146538028615958190382830813395b-173 + x * (4737564581099604249852567829707944940460501354987b-174 + x * (19508173607844763061526398982921782866373719408881b-179 + x * (28028384585901080300830750040726581293938320938545b-183 + x * 44836930378672942548678299103511494860025777760483b-186)))))))));
midpointmode=on!;
supnorm(p, exp(x), [0;1], absolute, 2^(-40));

print("=============== Check Supnorm #3 ================");//passes
mode=relative;
theta=1b-135;
d = [-1b-2;1b-2];
f = expm1(x);
p = x * (1 +  x * ( 2097145 * 2^(-22) + x * ( 349527 * 2^(-21) + x * (87609 * 2^(-21) + x * 4369 * 2^(-19))))); 
theta=1b-40;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #4 ================");//passes
mode=relative;
d = [-1b-9;1b-9];
f = log2(1 + x);
p = x * (117045327009867803036301574157545b-106 + x * ((-58522663504933901606981166592605b-106) + x * (8663094464742397b-54 + x * ((-6497320848515433b-54) + x * (2598928339549937b-53 + x * ((-541446114948727b-51) + x * 3712726891772213b-54))))));
theta=1b-205;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #5 ================");//passes
mode=relative;
d = [-205674681606191b-53;205674681606835b-53];
f = asin(x + 0x3fe5e58f08291918);
p = 15651770362713997207607972106972745b-114 + (x *(3476698806776688943652103662933b-101 + (x *(17894972500311187082269807705171b-104 + (x *(126976607296441025269345153102591b-106 + (x *(249107378895562413495151944042799b-106 + (x *(139053951649796304768149995225589b-104 + (x *(165428664168251249501887921888847b-103 + (x *(206167601873884163281098618631159b-102 + (x *(66386611260133347295510390653099b-99 + (x * (2433556521489987b-43 + (x* (409716955440671b-39 + (x * (2242518346998655b-40 + (x *(3108616106416871b-39 + (x * (4356285307071455b-38 + (x *(6161286268548935b-37 + (x * (8783550111623067b-36 + (x *(788026560267325b-31 + (x * (1138037795125313b-30 + (x *(3304615966282565b-30 + (x * (602367826671283b-26 + (x *(1765006192104851b-26 + (x * (1337636086941861b-24 + (x *986777691264547b-22)))))))))))))))))))))))))))))))))))))))))));
theta=1b-60;
prec=400!;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #6 ================"); //passes
mode=relative;
prec=300!;
d = [-1/2;1/4];
f = cos(x);
p = 127314748520905380391777835589720039729342145097661090748478447318618529015203604765566689b-296 + x * (-1176183728229793751637043660065847579890970982973992202018192057755975433302793198324426573b-376 + x * (-127314748520905380391738345892360756681131303903716098475473212933227449963198807170652229b-297 + x * (411157279064246494121991117766105005568223464883775477360093918816839730397410047916370811b-366 + x * (21219124753484230053862417678170235538726463899369620274583864671581237263849631540786577b-298 + x * (-1410502123645648389482990176064909235877375828877296670824273606862416549384926673212331083b-361 + x * (-724279458252261210504349594121335100771624524830702920999146885115456299525648100748351663b-308 + x * (134774797018080532192428177850854993385334368268780691241634121499347615118037692190732043b-352 + x * (1655495904576160557613610377255708869921184205441524773073593312341561508689495751645348449b-315 + x * (-1594094643995802407650998956215005582984707081147652766864332919805511367571909433687622335b-351 + x * (-294310383550327313556374414541449084070746487392752536766971007548680728836036254508146929b-319 + x * (512235774726334150822554392967816790007421386839936546743269207769528982853397644167067871b-346 + x * (1141573461565483381928707239907860736890956525739802194008371659491759020277390103225113401b-328 + x * (-1569482484524507248868121030716379419120450572564469525806037183646518163382197401885965253b-347 + x * (-1614534504445457486506762534809318663084383593349434912234239957430266631356959991774123565b-336 + x * (-1712106093024186385498521252470153327699204358233691202131099406230733496689604124499970149b-343)))))))))))))));
prec=default!;
theta=1b-100;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #7 ================");//passes
mode=relative;
prec=400!;
d = [-1/8;1/8];
f = exp(x);
p=1291124939043454294827959586001505937164852896414611756415643039531479680609629260097919725377401206658955423510867812933b-399 + x * (1291124939043454294827959586001505937164852896414611756407759293348856964764186953322986589460672969435069958748491718283b-399 + x * (1291124939043454294827959586001505937164852896414611742842916313201487217248242990712587184030633906090137602556193308777b-400 + x * (1721499918724605726437279448002007916219803861886149410406732804556694110264268799366882772800656159765418763369767923869b-402 + x * (1721499918724605726437279448002007916219803861886928049851542292580594202097368397525596049532723601180890716568841852971b-404 + x * (688599967489842290574911779200803166487921544748146677805317095693650672977111381945276005270502268669363247750562141109b-405 + x * (918133289986456387433215705601070888650562042107828893577378984985802017340780034420418039342182577636371604545753247685b-408 + x * (2098590377111900314133064469945304888344142586006558021664462294500550566006715853849729548335450138563444975611072384915b-412 + x * (2098590377111900314133064469945304888345787506900621321180727067543258071161052823401917797089874824160141551745303600509b-415 + x * (932706834271955695170250875531246617029863789325186530775644670361528998993026253332715955100711707177976542185420125885b-417 + x * (186541366854391139034050175106249317675194606310468992601212125887714941698557011635643430617148947777325881970320599911b-418 + x * (2170663177942005981487129310327265817430136743794322761791212108289168199121016399511022765792217934974290164512400558051b-425 + x * (723554392647335327162376436776575188728320134851889625237160943201761614313054850997686096169392444013734775049800364135b-427 + x * (445264241629129432099923961086461053843117889043738115595645570179588863813466486158437851805221549064027305469772175195b-430 + x * (1017746838009438701942683300338197780799042429908471623542287463474569859335113951279406783547674904661405075222370152653b-435 + x * (271399156802516987184715668022449290765604321334910931946270618816084433310692805993200010568980374341586319016626039405b-437 + x * (2171193254420135897480301350825607712011172107075923446450599655895677713120365969751962821314954760562289074188094789451b-444 + x * (2043476004160127903487494000509588015818708867395743746978714423885089009799059654843663103804548054018562648174876580061b-448 + x * (908211557404501261461971507657492862559270740528797479096948806118152290717219182619080722630251277564118402740142879215b-451 + x * (1529619465102318290396191335466982351668824576419822769979570691542070957164975362583515486255615591549174162951007028183b-456 + x * (1223695572082734528475377304206308178928295327141464300806858140000189195058732384055167155268721672655962320814134386585b-460 + x * (466169741743865438694533850917589402256859012268885527875904121812833883515506233431119922322746057508112973882086354899b-463 + x * (339032535142399295985553596850309623127346596956633233039500677601672953959025144616613616695701925012721839172059538925b-467 + x * (1886789853182169718590609346799899921135706970254622139162686047099233945700405342620686331475908007094622992876398666851b-474 + x * (2516112710027923243369908368888976324181415757063417914589335963128261275982808145367994972728592019136949818934599107321b-479 + x * 1609827695620693077847485865687191912593223271819829393342670614997995102920099238219568170602045477783711943005139617211b-483))))))))))))))))))))))));
prec=300!;
theta=1b-250;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #8 ================");//passes
prec=200!;
d = [-1/2;1/2];
f = sin(x);
p = -347829885687651467b-246 + x * (803469022129285046899203980724876839838081336629987901112093b-199 + x * (109096980796689175283906477509258920482015377728962864177675b-376 + x * (-1071292029371495160966220394362561448878316413905740061801453b-202 + x * (-895936839379960786335981881158765658035426638215168714136065b-374 + x * (107129196922888615341858264807183824745523003519500238173771b-203 + x * (549328822047401762664326673644414324304203438857246608800061b-370 + x * (-163240970783780006076567571219952019240960058303028805468663b-209 + x * (-1596659384420598775289000423725712515716892556010679852042289b-370 + x * 288403825950454274847258834876617249588530907170098884348709b-216))))))));
prec=default!;
mode=absolute;
theta=1b-60;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #9 ================");//passes
prec=200!;
d = [1;2];
f = exp(cos(x)^2 + 1);
p = 714564886172317927063761490159801881657790980941829344505187b-196 + x * (1258278747211590164438565899307058663065266457630726920586347b-198 + x * (-1202878917246296858587934180920738608442450059984305974754429b-195 + x * (1347350830264911057006851046105206644501121822225011999522971b-194 + x * (-1411317735908160715166251154609539762583930758208235515249453b-193 + x * (73796213723185208671599520928107052835549956637208706117423b-188 + x * (-1400829552020409071501690715419925186599874208109719920625025b-192 + x * (1180386509055370140909826097725837306233406594495350257599181b-192 + x * (-1440803466241145176052471822037050974100822411994796391357023b-193 + x * (1285581190272567034084556062052191954533209585841927847519185b-194 + x * (-832171048091233324734778875003324601584470829671170926930407b-195 + x * (1516396334943608786362280214735888311251638283061986162266693b-198 + x * (-113252562973107828059488836912840143838508857783935522775583b-197 + x * (296982459360723712812328947424418991885288241395500095736051b-202 + x * (-1304662018163848750887736589024039856901512907618757724445671b-210 + x * (-1458138089985030045170976059909283198365479948394215945263081b-213)))))))))))))));
theta=1b-60;
prec=default!;
mode=relative;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #10 ================");//passes
prec=200!;
d=[1/4;1/2];
f=tan(x);
p =  273663424726598609884436588659142529896812070463680189713577b-217 + x * (803437057336964936961730558645726525457791801950137631592037b-199 + x * (225505423592202238519775811845273269657276115111137681553489b-208 + x * (528444817941611504637035117719962221857671105434203759656937b-200 + x * (1239694968725463472760134669503154963255295977288296254470181b-205 + x * (1130131417499222086385911795575835445432295919090159931462145b-204 + x * (1491287505779580922293205133224642959388076368487724135077821b-202 + x * (-1171551728340426070339628381549725358789127811584978046693913b-201 + x * (406987388528718637810250849111810189760762571987387168281935b-199 + x * (-143338466912831507573865657425240839471014755173174001588205b-198 + x * 909290520151942024628769491295084023281483044413748718543747b-202)))))))));
prec=default!;
mode=relative;
theta=1b-60;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #11 ================");//passes
d=[1;2];
f=x^2.5;
p=30384532462332540461916109637629717389849711316821b-171 + x * (-31904713954983344143590115593939596870834806750785b-168 + x * (3202922742084579220140950796580716782899394760489b-162 + x * (15112977993516225491652585788177447394030781112913b-164 + x * (-7069971332398015962219468854462076062374294828243b-165 + x * (7083002129884149408404809852482217256950901287813b-167 + x * (-37227478455235357414551691036580021152370979146031b-172 + x * 45273032627293166114769155909287202062101002901785b-176))))));
mode=relative;
theta=1b-35;
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #12 ================");//passes
restart;
mode=relative;
d=[-1/8;1/8];
f=sin(x);
verbosity=0!;
print("Computing remez polynomial...");
p =fpminimax(sin(x), [|3,5|],[|D,D|], [-1/8; 1/8],x);
print("... done.");
verbosity=1!;
theta = 2^(-16);
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #13 ================");//passes
restart;
mode=absolute;
d=[-347,348]/1000;
f=exp(x);
p=1.86264514923095703125e-9 + 1.99542657355777919292449951171875e-4 * x^7 + 1.384407165460288524627685546875e-3 * x^6 + 8.33319686353206634521484375e-3 * x^5+ 4.16684038937091827392578125e-2 * x^4 + 0.16666667163372039794921875 * x^3 + 0.49999988079071044921875 * x^2 + x + 1;
theta = 2^(-40);
supnorm(p,f,d,mode,theta);

print("=============== Check Supnorm #14 ================");
testSupnorm = proc(p,f,I,mode,theta) {
  var oldPrec, r, s;
  oldPrec = prec;
  prec = -ceil(log2(theta))+30;
  if (mode == absolute)
  then r = dirtyinfnorm(p-f,I)
  else r = dirtyinfnorm(p/f-1,I);
  prec = oldPrec!;
  s = supnorm(p,f,I,mode,theta);

  print("Testing example: supnorm(",p,",",f,",",I,",",mode,",",theta,")");

  if !(r in s)
  then print("   --> testSupnorm detected an error: true infnorm not in the interval");

  if (inf(s) < 0)
  then print("   --> testSupnorm error: computed interval contains negative numbers");

  if (sup(s)-inf(s)) > inf(s)*theta
  then print("   --> testSupnorm: error on the accuracy of the result on");

  return void;
};

p = 11692536319630510474283968587625525849426869787677b-163 + x * (23384922893552793741208186896732057180708286140565b-164 + x * (46692941277611593554424973690517694800554713844979b-166 + x * (3891678517537147456387754739468835779118224484425b-164 + x * (1024072943597638219514404758611859127188920401873b-164 + x * 26154763285557255659575812244171511366994513699585b-171))));
testSupnorm(p, exp(x), [-1;1], absolute, 2^(-40));

p = 23384026197294909850223840992809340481141545456185b-164 + x * (46768052394366389249957592514757698261837941537431b-165 + x * (1461501637882931916249380248092291325347144984355b-161 + x * (15589350524874704484650079886308075573528112666971b-166 + x * (31178718928032908530740508502853005869373616353571b-169 + x * (6235660318693530982722236353851527754167773984285b-169 + x * (16632313913972289150146538028615958190382830813395b-173 + x * (4737564581099604249852567829707944940460501354987b-174 + x * (19508173607844763061526398982921782866373719408881b-179 + x * (28028384585901080300830750040726581293938320938545b-183 + x * 44836930378672942548678299103511494860025777760483b-186)))))))));
testSupnorm(p, exp(x), [0;1], absolute, 2^(-40));

mode=relative;
theta=1b-135;
d = [-1b-2;1b-2];
f = expm1(x);
p = x * (1 +  x * ( 2097145 * 2^(-22) + x * ( 349527 * 2^(-21) + x * (87609 * 2^(-21) + x * 4369 * 2^(-19))))); 
theta=1b-40;
testSupnorm(p,f,d,mode,theta);

mode=relative;
d = [-1b-9;1b-9];
f = log2(1 + x);
p = x * (117045327009867803036301574157545b-106 + x * ((-58522663504933901606981166592605b-106) + x * (8663094464742397b-54 + x * ((-6497320848515433b-54) + x * (2598928339549937b-53 + x * ((-541446114948727b-51) + x * 3712726891772213b-54))))));
theta=1b-205;
testSupnorm(p,f,d,mode,theta);


mode=relative;
d = [-205674681606191b-53;205674681606835b-53];
f = asin(x + 0x3fe5e58f08291918);
p = 15651770362713997207607972106972745b-114 + (x *(3476698806776688943652103662933b-101 + (x *(17894972500311187082269807705171b-104 + (x *(126976607296441025269345153102591b-106 + (x *(249107378895562413495151944042799b-106 + (x *(139053951649796304768149995225589b-104 + (x *(165428664168251249501887921888847b-103 + (x *(206167601873884163281098618631159b-102 + (x *(66386611260133347295510390653099b-99 + (x * (2433556521489987b-43 + (x* (409716955440671b-39 + (x * (2242518346998655b-40 + (x *(3108616106416871b-39 + (x * (4356285307071455b-38 + (x *(6161286268548935b-37 + (x * (8783550111623067b-36 + (x *(788026560267325b-31 + (x * (1138037795125313b-30 + (x *(3304615966282565b-30 + (x * (602367826671283b-26 + (x *(1765006192104851b-26 + (x * (1337636086941861b-24 + (x *986777691264547b-22)))))))))))))))))))))))))))))))))))))))))));
theta=1b-60;
prec=400!;
testSupnorm(p,f,d,mode,theta);


mode=relative;
prec=300!;
d = [-1/2;1/4];
f = cos(x);
p = 127314748520905380391777835589720039729342145097661090748478447318618529015203604765566689b-296 + x * (-1176183728229793751637043660065847579890970982973992202018192057755975433302793198324426573b-376 + x * (-127314748520905380391738345892360756681131303903716098475473212933227449963198807170652229b-297 + x * (411157279064246494121991117766105005568223464883775477360093918816839730397410047916370811b-366 + x * (21219124753484230053862417678170235538726463899369620274583864671581237263849631540786577b-298 + x * (-1410502123645648389482990176064909235877375828877296670824273606862416549384926673212331083b-361 + x * (-724279458252261210504349594121335100771624524830702920999146885115456299525648100748351663b-308 + x * (134774797018080532192428177850854993385334368268780691241634121499347615118037692190732043b-352 + x * (1655495904576160557613610377255708869921184205441524773073593312341561508689495751645348449b-315 + x * (-1594094643995802407650998956215005582984707081147652766864332919805511367571909433687622335b-351 + x * (-294310383550327313556374414541449084070746487392752536766971007548680728836036254508146929b-319 + x * (512235774726334150822554392967816790007421386839936546743269207769528982853397644167067871b-346 + x * (1141573461565483381928707239907860736890956525739802194008371659491759020277390103225113401b-328 + x * (-1569482484524507248868121030716379419120450572564469525806037183646518163382197401885965253b-347 + x * (-1614534504445457486506762534809318663084383593349434912234239957430266631356959991774123565b-336 + x * (-1712106093024186385498521252470153327699204358233691202131099406230733496689604124499970149b-343)))))))))))))));
prec=default!;
theta=1b-100;
testSupnorm(p,f,d,mode,theta);


mode=relative;
prec=400!;
d = [-1/8;1/8];
f = exp(x);
p=1291124939043454294827959586001505937164852896414611756415643039531479680609629260097919725377401206658955423510867812933b-399 + x * (1291124939043454294827959586001505937164852896414611756407759293348856964764186953322986589460672969435069958748491718283b-399 + x * (1291124939043454294827959586001505937164852896414611742842916313201487217248242990712587184030633906090137602556193308777b-400 + x * (1721499918724605726437279448002007916219803861886149410406732804556694110264268799366882772800656159765418763369767923869b-402 + x * (1721499918724605726437279448002007916219803861886928049851542292580594202097368397525596049532723601180890716568841852971b-404 + x * (688599967489842290574911779200803166487921544748146677805317095693650672977111381945276005270502268669363247750562141109b-405 + x * (918133289986456387433215705601070888650562042107828893577378984985802017340780034420418039342182577636371604545753247685b-408 + x * (2098590377111900314133064469945304888344142586006558021664462294500550566006715853849729548335450138563444975611072384915b-412 + x * (2098590377111900314133064469945304888345787506900621321180727067543258071161052823401917797089874824160141551745303600509b-415 + x * (932706834271955695170250875531246617029863789325186530775644670361528998993026253332715955100711707177976542185420125885b-417 + x * (186541366854391139034050175106249317675194606310468992601212125887714941698557011635643430617148947777325881970320599911b-418 + x * (2170663177942005981487129310327265817430136743794322761791212108289168199121016399511022765792217934974290164512400558051b-425 + x * (723554392647335327162376436776575188728320134851889625237160943201761614313054850997686096169392444013734775049800364135b-427 + x * (445264241629129432099923961086461053843117889043738115595645570179588863813466486158437851805221549064027305469772175195b-430 + x * (1017746838009438701942683300338197780799042429908471623542287463474569859335113951279406783547674904661405075222370152653b-435 + x * (271399156802516987184715668022449290765604321334910931946270618816084433310692805993200010568980374341586319016626039405b-437 + x * (2171193254420135897480301350825607712011172107075923446450599655895677713120365969751962821314954760562289074188094789451b-444 + x * (2043476004160127903487494000509588015818708867395743746978714423885089009799059654843663103804548054018562648174876580061b-448 + x * (908211557404501261461971507657492862559270740528797479096948806118152290717219182619080722630251277564118402740142879215b-451 + x * (1529619465102318290396191335466982351668824576419822769979570691542070957164975362583515486255615591549174162951007028183b-456 + x * (1223695572082734528475377304206308178928295327141464300806858140000189195058732384055167155268721672655962320814134386585b-460 + x * (466169741743865438694533850917589402256859012268885527875904121812833883515506233431119922322746057508112973882086354899b-463 + x * (339032535142399295985553596850309623127346596956633233039500677601672953959025144616613616695701925012721839172059538925b-467 + x * (1886789853182169718590609346799899921135706970254622139162686047099233945700405342620686331475908007094622992876398666851b-474 + x * (2516112710027923243369908368888976324181415757063417914589335963128261275982808145367994972728592019136949818934599107321b-479 + x * 1609827695620693077847485865687191912593223271819829393342670614997995102920099238219568170602045477783711943005139617211b-483))))))))))))))))))))))));
prec=300!;
theta=1b-250;
testSupnorm(p,f,d,mode,theta);


prec=200!;
d = [-1/2;1/2];
f = sin(x);
p =  -347829885687651467b-246 + x * (803469022129285046899203980724876839838081336629987901112093b-199 + x * (109096980796689175283906477509258920482015377728962864177675b-376 + x * (-1071292029371495160966220394362561448878316413905740061801453b-202 + x * (-895936839379960786335981881158765658035426638215168714136065b-374 + x * (107129196922888615341858264807183824745523003519500238173771b-203 + x * (549328822047401762664326673644414324304203438857246608800061b-370 + x * (-163240970783780006076567571219952019240960058303028805468663b-209 + x * (-1596659384420598775289000423725712515716892556010679852042289b-370 + x * 288403825950454274847258834876617249588530907170098884348709b-216))))))));
prec=default!;
mode=absolute;
theta=1b-60;
testSupnorm(p,f,d,mode,theta);


prec=200!;
d = [1;2];
f = exp(cos(x)^2 + 1);
p = 714564886172317927063761490159801881657790980941829344505187b-196 + x * (1258278747211590164438565899307058663065266457630726920586347b-198 + x * (-1202878917246296858587934180920738608442450059984305974754429b-195 + x * (1347350830264911057006851046105206644501121822225011999522971b-194 + x * (-1411317735908160715166251154609539762583930758208235515249453b-193 + x * (73796213723185208671599520928107052835549956637208706117423b-188 + x * (-1400829552020409071501690715419925186599874208109719920625025b-192 + x * (1180386509055370140909826097725837306233406594495350257599181b-192 + x * (-1440803466241145176052471822037050974100822411994796391357023b-193 + x * (1285581190272567034084556062052191954533209585841927847519185b-194 + x * (-832171048091233324734778875003324601584470829671170926930407b-195 + x * (1516396334943608786362280214735888311251638283061986162266693b-198 + x * (-113252562973107828059488836912840143838508857783935522775583b-197 + x * (296982459360723712812328947424418991885288241395500095736051b-202 + x * (-1304662018163848750887736589024039856901512907618757724445671b-210 + x * (-1458138089985030045170976059909283198365479948394215945263081b-213)))))))))))))));
theta=1b-60;
prec=default!;
mode=relative;
testSupnorm(p,f,d,mode,theta);


prec=200!;
d=[1/4;1/2];
f=tan(x);
p = 273663424726598609884436588659142529896812070463680189713577b-217 + x * (803437057336964936961730558645726525457791801950137631592037b-199 + x * (225505423592202238519775811845273269657276115111137681553489b-208 + x * (528444817941611504637035117719962221857671105434203759656937b-200 + x * (1239694968725463472760134669503154963255295977288296254470181b-205 + x * (1130131417499222086385911795575835445432295919090159931462145b-204 + x * (1491287505779580922293205133224642959388076368487724135077821b-202 + x * (-1171551728340426070339628381549725358789127811584978046693913b-201 + x * (406987388528718637810250849111810189760762571987387168281935b-199 + x * (-143338466912831507573865657425240839471014755173174001588205b-198 + x * 909290520151942024628769491295084023281483044413748718543747b-202)))))))));
prec=default!;
mode=relative;
theta=1b-60;
testSupnorm(p,f,d,mode,theta);


d=[1;2];
f=x^2.5;
p=30384532462332540461916109637629717389849711316821b-171 + x * (-31904713954983344143590115593939596870834806750785b-168 + x * (3202922742084579220140950796580716782899394760489b-162 + x * (15112977993516225491652585788177447394030781112913b-164 + x * (-7069971332398015962219468854462076062374294828243b-165 + x * (7083002129884149408404809852482217256950901287813b-167 + x * (-37227478455235357414551691036580021152370979146031b-172 + x * 45273032627293166114769155909287202062101002901785b-176))))));
mode=relative;
theta=1b-35;
testSupnorm(p,f,d,mode,theta);


mode=relative;
d=[-1/8;1/8];
f=sin(x);
verbosity=0!;
p =fpminimax(sin(x), [|3,5|],[|D,D|], [-1/8; 1/8],x);
verbosity=1!;
theta = 2^(-16);
testSupnorm(p,f,d,mode,theta);


/* Example by Florent de Dinechin, that used to lead to a bug */
/* before revision #1852                                      */
mode=absolute;
I=[-347,348]/1000;
f=exp(x);
p=1.86264514923095703125e-9 + 1.99542657355777919292449951171875e-4 * x^7 + 1.384407165460288524627685546875e-3 * x^6 + 8.33319686353206634521484375e-3 * x^5+ 4.16684038937091827392578125e-2 * x^4 + 0.16666667163372039794921875 * x^3 + 0.49999988079071044921875 * x^2 + x + 1;
theta = 2^(-40);
verbosity=1!;
testSupnorm(p,f,d,mode,theta);


/* Example by Florent de Dinechin, that used to lead to a bug */
/* before revision #1425                                      */
prec=300; /* should be enough for anybody */
M=32768;
isize=1/M;
d=4;
f=exp(x)/2;

/* The following polynomials were obtained by the following line. */
/* for i from 0 to 20 do { I=[1+i*isize, 1+(i+1)*isize]; p = remez(f,d, I); }; */

I = [1;32769b-15];
p = 519116931250074582514616920029812964033041191732166366208315683368591845444321107391435481b-299 + x * (461432969284079015555143407908324792312068012734235836652935285714259885748478589922847529b-299 + x * (346082648236258546966032322765771598479520265273144739387947665823565730921236322003050251b-299 + x * (-1845774007687049558287217203353987444440450373590070022669568374961280228727054054051744831b-318 + x * 1845774123550678624355073867555708750724188033665817979913979575189149376462087383277483735b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32769b-15;16385b-14];
p = 259559345879600238994341752459837595545898720439675950801653623776773076903600946303425701b-298 + x * (461425927462476339021923881761660260730722077159602256751190602125239693445609261724005265b-299 + x * (173046605323160776594250612156380219803360425927054552866876177566765761644836318442542137b-298 + x * (-1384372810757865863246870774013473664314069086622551199217497615213803454026373438271894305b-316 + x * 922915226483104741726827502416104539849150495728611277321715440071753646193388254121647135b-303)));
testSupnorm(p,f,I,absolute,1b-5);

I = [16385b-14;32771b-15];
p = 1038240905073938809564185146674779242326355205294558935393649861808689793476646895917998267b-300 + x * (1845675539125013381333631624704875717580705390911799805070033763505954280685015813184580603b-301 + x * (346103774023416837754962784984162191045292920130593796757336225574631447590348180153720899b-299 + x * (-576839612789582407852511079083681823850070896509088950771773952643899923582045367370743271b-314 + x * 1845886784100803912445798173029574729693497483658677219270101727506998653158623117662166741b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32771b-15;8193b-13];
p = 259561106791707898293039710633779037559822312544256220625440469079039924536763394805587147b-298 + x * (922823682480649549181635253331914708804520679107862064077300309229451099522323876193792447b-300 + x * (692228676735226522485987916737252642808432088179842657020342965630357539103964428753876415b-300 + x * (-1615200212850920429100564708444107526276999411623835378169119182171976132997095979778353947b-315 + x * 1845943116954514373788808938428499536418675482610443460189101910631877163996812552600989749b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [8193b-13;32773b-15];
p = 259561987449287045372398701594868201437910171545243585338079477748382151643808715566064285b-298 + x * (461404796839605360090310517684534574578803789973564267751021643064931898303836675409485003b-299 + x * (1384499614715918752531672507766016877483227007979622376860398775113317547154472447117451495b-301 + x * (-519187342120898954534613462928357592655366197366771351797841056730732196163723897029023901b-313 + x * 461499862881848332885261109186422889231489482986384996333218781467310163853332033421724343b-302)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32773b-15;16387b-14];
p = 1038251472964957456511274192114220005337879717080719570375573248266731133533241225649522435b-300 + x * (1845591006316039313290133964477145081689851856783638624326715045513174026252404653737886631b-301 + x * (692270939915169973615995000980032897935311272581302256923437696401939708362861132946356933b-300 + x * (-1269163346883319747703475308401267430788360043492450542435418710231856874897867418320603237b-314 + x * 1846055787819493251361962234095780806068142607601605103638827981559814019954344633044560891b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [16387b-14;32775b-15];
p = 519127498335164153769545486623552954988858606273181999481850530462359154784932201346547583b-299 + x * (57673838182306612371522122429243846436523792555944999449682277907052548272208183655835053b-296 + x * (1384584148813992118218502092824141150820996752581358234459863858555017921829378462850028367b-301 + x * (-749983047497388110438910296743146915050879640660709438285264950717168395163254780340785913b-313 + x * 923056062915433300256084594722183984064011594047292071874020456477159522961651084828636705b-303)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32775b-15;4097b-12];
p = 1038258520913329631182690364241114017060837400037458356533335658790054633062991223135847083b-300 + x * (922767316955698569835057986917688386448502196160618545538697046612402761485504819176131747b-300 + x * (1384626421667150770250077157787397840104496347465470608587010281772184260559770572844451389b-301 + x * (-1730782929220944054148482567938745159575983219937856205356812931355746976103146441344064741b-314 + x * 923084232780782923926735159276129795162580209945750248756228435482594096783073927189113911b-303)));
testSupnorm(p,f,I,absolute,1b-5);

I = [4097b-12;32777b-15];
p = 1038262045694030331360107288571033481310845936055396192569911648051621914710101903264082523b-300 + x * (1845506442548454768920116619308727687991614007806277523964786136086245050686512829575540843b-301 + x * (173083587298761427962455984082138996639756712278337144683760477571124473370811720671440019b-298 + x * (-1961613850206626209203908481303935475641262125973990140990420781913512806725438551266796249b-314 + x * 28847262609556929122639338428295863535850904646269632285682528473324343941472711236120323b-298)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32777b-15;16389b-14];
p = 519132785506249659649202446742857299970401223489329249721092671862612630646516898175534471b-299 + x * (922739123872321640347645406112487210240542424232485865309181772337452142304813401978565157b-300 + x * (1384710978983089614554980944010000553236544926984416074420180493723390468154027020533019691b-301 + x * (-274057357324581485608201308026878795188066463784519077329794224330771414587511991256451199b-311 + x * 923140575090575960281429569584646159509857496569850532443973947641407848668443675573329097b-303)));
testSupnorm(p,f,I,absolute,1b-5);

I = [16389b-14;32779b-15];
p = 1038269096868805513534313111478982447499567985886901087470013707112958430927074529916221503b-300 + x * (461362512374905361205314477272078740242543628543999160703908952120861344496842228577269743b-299 + x * (1384753263446420894419446876259873246324214849677181076946472494396922068919278640451755047b-301 + x * (-151457372189742282380564974932184695701528669865661181732727523471584812692104667365872837b-310 + x * 1846337495070143691660987442551713494094189875111533870425503384713132809361507336644501653b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32779b-15;8195b-13];
p = 1038272623263017839914867268472181816124048738689268437118348367906699145773870774240355785b-300 + x * (922710923906524001945445745152899793118890970496765030462083763852500822751224932752694597b-300 + x * (346198887945090207628197443350771030623367818935766056578607553395243487815009400001806777b-299 + x * (-1327095570084590892482248321617848024550507093692816293544367981217834754916826593017873595b-313 + x * 1846393841678671252410388881767503175569108331880463934519747356162465088383552611134742243b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [8195b-13;32781b-15];
p = 1038276150195205231598046738711326787177258175938486395650936392494584531982139206239184115b-300 + x * (1845393642684581673262535084218842151923675663720046624798283948403833291890563117846027567b-301 + x * (692418921992592502835948587721625658789940441742669912865045829664790944938388346827005581b-300 + x * (-90158700457546112553689981541875410522556478042701804576870900283483380686066639012347575b-309 + x * 1846450190006787079679592267911737638039999300863927226721933815878236131218424338147248637b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32781b-15;16391b-14];
p = 259569919416359157263353411595457107631487782846370515248264225272015360527824594363826399b-298 + x * (115335339632117571316138611855828589074790000759090941028960355593604439013749368475305519b-297 + x * (173110017507646127293946241187089077523281184437658863294068384210744593210320374774470417b-298 + x * (-389497472387211515714083349816328582000148764030707683808210862949049454218666003932452401b-311 + x * 923253270027271825969308891928787425004862776651570518692548000594247064900609481273701205b-303)));
testSupnorm(p,f,I,absolute,1b-5);

I = [16391b-14;32783b-15];
p = 259570801418445245015687903485943574498601360020182138502329261108536813923730828200157649b-298 + x * (922668611050302534080934898631305920411094546122620794898781179178634855962297002938501693b-300 + x * (692461220004294241312646047790092524767520494616918667790850352278478544328296882325785843b-300 + x * (-836723808545697939112234873358000218526157193537343518615496583467554964894103029621900829b-312 + x * 1846562891821993449259025858640069344956107939816934711188318981197769300250836168040094629b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32783b-15;2049b-11];
p = 259571683555076809930176139297683386955685058287604850979903763489274736505396093554902655b-298 + x * (230663625830551511027192226102459351920295795989831299121279326548326987787810106349780085b-298 + x * (1384964743827719028186000887082096548757082279105992481526183914645467274070385228978366589b-301 + x * (-894456195135440284141609327212459558817515685541830444876237823904260130502919981948908811b-312 + x * 230827405663648619164245755416442209740139242492784744544396974938886538140919673352686421b-301)));
testSupnorm(p,f,I,absolute,1b-5);

I = [2049b-11;32785b-15];
p = 1038290263305084370435415527035061707258965208781125421881811017400775982836689287832498437b-300 + x * (922640393872480403813800177925378752771650649922883158877492845194018352634074411452631987b-300 + x * (346251762879709075086714161479764494408878621778635937736199289312967985107888531917047479b-299 + x * (-1904384209409806576422326601306777292609996776581303101650200507548829594497052950791270799b-313 + x * 115417225032261415461139118025532499176730999418087825463225707062475600857604464856136861b-300)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32785b-15;16393b-14];
p = 519146896464090670964582799011339625361876312484969902057815620146269561200434887534159019b-299 + x * (1845252565401909805550983016207725648118133331833299293068913447565582599940098460236009525b-301 + x * (692524681541107980021006426189471824108643433249699138962602974659896609355108049907080037b-300 + x * (-2019863074830693468602081973853455808051455628892417786481781217095104791718307892255975487b-313 + x * 1846731957443027016328279822610383179119522193788621019425224466359105936867359776524053851b-304)));
testSupnorm(p,f,I,absolute,1b-5);

I = [16393b-14;32787b-15];
p = 519148661544833565619506401790149170652856917396709726481254733925537369008626326938023379b-299 + x * (461306084903729408475343382353118217458409264416593990336519465374065414570142746343644699b-299 + x * (692545839259066841913693084826024353050072653235181386446947448934842222203991510311351165b-300 + x * (-533837246714018483463474683374017527963804145912645028413910010347015603890072616225241919b-311 + x * 230848539511221818330292254161201408213505190039127578629236006613941351929211061163522149b-301)));
testSupnorm(p,f,I,absolute,1b-5);

I = [32787b-15;8197b-13];
p = 1038300853789610722717431117998072253672745354894008819884081084657821028564524445454214615b-300 + x * (1845196110383642817345436810488640607378390169031036789043227353450295491835812658289636905b-301 + x * (692566998913432581940713261525895859800522806638943732672249466782621346213478048459687287b-300 + x * (-1125420972904246892390459207958219498521812206768675803782281061311812650143794730019899921b-312 + x * 461711169114119431600098837063457091400141886505066126250922281425831581589518701106964503b-302)));
testSupnorm(p,f,I,absolute,1b-5);

I = [8197b-13;32789b-15];
p = 519152192514040554016474742575321083410893084087098308865742453759215532184957245983602373b-299 + x * (1845167877707743853301029862315370528448617293542570314524618753478073223326233590600403577b-301 + x * (692588160504343054002943606963215449206110461234668475778759373903297649222417605048086595b-300 + x * (-1183170976005255979029315231480326390896172552224746358319575240469607883060061798171116925b-312 + x * 57715657454474657665133753721862497061635908198782446418079866976955624534919461456070095b-299)));
testSupnorm(p,f,I,absolute,1b-5);
